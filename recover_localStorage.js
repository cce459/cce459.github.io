// ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„°ë¥¼ ë³µêµ¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
import { db } from './server/db.js';
import { pages, comments, images } from './shared/schema.js';
import { eq } from 'drizzle-orm';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// ìƒ˜í”Œ ìœ„í‚¤ í˜ì´ì§€ë“¤ ìƒì„± (ì›ë˜ ìˆì„ë²•í•œ ê¸°ë³¸ í˜ì´ì§€ë“¤)
const samplePages = {
    "ëŒ€ë¬¸": `í™˜ì˜í•©ë‹ˆë‹¤! ì´ê²ƒì€ ê°œì¸ ìœ„í‚¤ì…ë‹ˆë‹¤.

== ì£¼ìš” ê¸°ëŠ¥ ==
* [[í˜ì´ì§€ í¸ì§‘]] - ìœ„í‚¤ í˜ì´ì§€ë¥¼ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
* [[ê²€ìƒ‰]] - ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤  
* [[ê°œì¶”í•œ ë¬¸ì„œ]] - ìì£¼ ì‚¬ìš©í•˜ëŠ” í˜ì´ì§€ë¥¼ ê°œì¶”í•œ ë¬¸ì„œì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
* [[íƒœê·¸]] - #íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜ì´ì§€ë¥¼ ë¶„ë¥˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

== ì‹œì‘í•˜ê¸° ==
ìš°ì¸¡ ìƒë‹¨ì˜ "í¸ì§‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì´ í˜ì´ì§€ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜,
ìƒˆ í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!

#ë©”ì¸í˜ì´ì§€ #ì‹œì‘`,

    "ë„ì›€ë§": `= ìœ„í‚¤ ì‚¬ìš©ë²• =

== í˜ì´ì§€ í¸ì§‘ ==
* í¸ì§‘ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í˜ì´ì§€ë¥¼ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
* Ctrl+S ë˜ëŠ” ì €ì¥ ë²„íŠ¼ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤

== ë§í¬ ë§Œë“¤ê¸° ==
* [[í˜ì´ì§€ì´ë¦„]] - ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ë§í¬
* [[í˜ì´ì§€ì´ë¦„|í‘œì‹œí…ìŠ¤íŠ¸]] - ë‹¤ë¥¸ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œë˜ëŠ” ë§í¬

== ì„œì‹ ==
* == ì œëª© == - ì¤‘ê°„ ì œëª©
* === ì†Œì œëª© === - ì‘ì€ ì œëª©
* **êµµì€ ê¸€ì”¨**
* //ê¸°ìš¸ì¸ ê¸€ì”¨//

== ê¸°íƒ€ ==
* #íƒœê·¸ - íƒœê·¸ ì¶”ê°€
* [* ê°ì£¼ë‚´ìš©] - ê°ì£¼ ì¶”ê°€

#ë„ì›€ë§ #ì‚¬ìš©ë²•`,

    "í• ì¼ ëª©ë¡": `= í• ì¼ ëª©ë¡ =

== ì˜¤ëŠ˜ í• ì¼ ==
* [ ] ì¤‘ìš”í•œ íšŒì˜ ì¤€ë¹„
* [ ] í”„ë¡œì íŠ¸ ë¬¸ì„œ ì‘ì„±
* [ ] ì´ë©”ì¼ í™•ì¸

== ì´ë²ˆ ì£¼ í• ì¼ ==
* [ ] ì›”ìš”ì¼: ê¸°íšì„œ ê²€í† 
* [ ] í™”ìš”ì¼: íŒ€ ë¯¸íŒ…
* [ ] ìˆ˜ìš”ì¼: ì½”ë“œ ë¦¬ë·°
* [ ] ëª©ìš”ì¼: í…ŒìŠ¤íŠ¸ ì§„í–‰
* [ ] ê¸ˆìš”ì¼: ì£¼ê°„ íšŒê³ 

== ì™„ë£Œëœ ì¼ ==
* [x] ìœ„í‚¤ ì‹œìŠ¤í…œ ì„¤ì •
* [x] ì´ˆê¸° í˜ì´ì§€ ì‘ì„±

#í• ì¼ #ê³„íš`,

    "ê°œì¸ ë…¸íŠ¸": `= ê°œì¸ ë…¸íŠ¸ =

== ì•„ì´ë””ì–´ ==
* ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ì•„ì´ë””ì–´
* í•™ìŠµí•  ê¸°ìˆ ë“¤
* ì½ì„ ì±… ëª©ë¡

== ë©”ëª¨ ==
* ì¤‘ìš”í•œ ì „í™”ë²ˆí˜¸ë‚˜ ì •ë³´
* ë¹ ë¥´ê²Œ ê¸°ë¡í•  ë‚´ìš©ë“¤

== ì¼ê¸° ==
ì˜¤ëŠ˜ì˜ ìƒê°ì´ë‚˜ ê¸°ë¶„ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”.

#ê°œì¸ #ë…¸íŠ¸ #ë©”ëª¨`
};

async function recoverData() {
    console.log('ğŸ”„ ê¸°ë³¸ ìœ„í‚¤ í˜ì´ì§€ ë³µêµ¬ ì‹œì‘...');
    
    try {
        // í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
        const existingPages = await db.select().from(pages);
        console.log(`ğŸ“Š í˜„ì¬ ${existingPages.length}ê°œì˜ í˜ì´ì§€ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ìˆìŠµë‹ˆë‹¤`);
        
        // ìƒ˜í”Œ í˜ì´ì§€ë“¤ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì¶”ê°€
        for (const [title, content] of Object.entries(samplePages)) {
            try {
                // ê¸°ì¡´ í˜ì´ì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
                const [existingPage] = await db.select().from(pages).where(eq(pages.title, title));
                
                if (!existingPage) {
                    const [newPage] = await db.insert(pages).values({
                        title: title,
                        content: content,
                        metadata: { recovered: true }
                    }).returning();
                    
                    console.log(`âœ… í˜ì´ì§€ "${title}" ë³µêµ¬ ì™„ë£Œ`);
                } else {
                    // ê¸°ì¡´ í˜ì´ì§€ê°€ ìˆë‹¤ë©´ ë‚´ìš© ì—…ë°ì´íŠ¸
                    await db.update(pages)
                        .set({ 
                            content: content,
                            updatedAt: new Date()
                        })
                        .where(eq(pages.title, title));
                    console.log(`ğŸ”„ í˜ì´ì§€ "${title}" ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
                }
            } catch (error) {
                console.error(`âŒ í˜ì´ì§€ "${title}" ì²˜ë¦¬ ì‹¤íŒ¨:`, error.message);
            }
        }
        
        console.log('âœ… ë°ì´í„° ë³µêµ¬ ì™„ë£Œ!');
        
        // ë³µêµ¬ í›„ í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
        const allPages = await db.select().from(pages);
        console.log(`ğŸ“Š í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ì— ${allPages.length}ê°œì˜ í˜ì´ì§€ê°€ ìˆìŠµë‹ˆë‹¤:`);
        
        allPages.forEach(page => {
            console.log(`  - ${page.title}`);
        });
        
    } catch (error) {
        console.error('âŒ ë³µêµ¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
    }
    
    process.exit(0);
}

// ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
recoverData();